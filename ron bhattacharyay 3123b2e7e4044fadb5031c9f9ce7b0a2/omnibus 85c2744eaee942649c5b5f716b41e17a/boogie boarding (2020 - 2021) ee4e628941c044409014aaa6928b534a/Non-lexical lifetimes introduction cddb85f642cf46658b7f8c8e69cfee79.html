<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Non-lexical lifetimes: introduction</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
}
.highlight-gray {
	color: rgb(155,154,151);
}
.highlight-brown {
	color: rgb(100,71,58);
}
.highlight-orange {
	color: rgb(217,115,13);
}
.highlight-yellow {
	color: rgb(223,171,1);
}
.highlight-teal {
	color: rgb(15,123,108);
}
.highlight-blue {
	color: rgb(11,110,153);
}
.highlight-purple {
	color: rgb(105,64,165);
}
.highlight-pink {
	color: rgb(173,26,114);
}
.highlight-red {
	color: rgb(224,62,62);
}
.highlight-gray_background {
	background: rgb(235,236,237);
}
.highlight-brown_background {
	background: rgb(233,229,227);
}
.highlight-orange_background {
	background: rgb(250,235,221);
}
.highlight-yellow_background {
	background: rgb(251,243,219);
}
.highlight-teal_background {
	background: rgb(221,237,234);
}
.highlight-blue_background {
	background: rgb(221,235,241);
}
.highlight-purple_background {
	background: rgb(234,228,242);
}
.highlight-pink_background {
	background: rgb(244,223,235);
}
.highlight-red_background {
	background: rgb(251,228,228);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(55, 53, 47, 0.6);
	fill: rgba(55, 53, 47, 0.6);
}
.block-color-brown {
	color: rgb(100,71,58);
	fill: rgb(100,71,58);
}
.block-color-orange {
	color: rgb(217,115,13);
	fill: rgb(217,115,13);
}
.block-color-yellow {
	color: rgb(223,171,1);
	fill: rgb(223,171,1);
}
.block-color-teal {
	color: rgb(15,123,108);
	fill: rgb(15,123,108);
}
.block-color-blue {
	color: rgb(11,110,153);
	fill: rgb(11,110,153);
}
.block-color-purple {
	color: rgb(105,64,165);
	fill: rgb(105,64,165);
}
.block-color-pink {
	color: rgb(173,26,114);
	fill: rgb(173,26,114);
}
.block-color-red {
	color: rgb(224,62,62);
	fill: rgb(224,62,62);
}
.block-color-gray_background {
	background: rgb(235,236,237);
}
.block-color-brown_background {
	background: rgb(233,229,227);
}
.block-color-orange_background {
	background: rgb(250,235,221);
}
.block-color-yellow_background {
	background: rgb(251,243,219);
}
.block-color-teal_background {
	background: rgb(221,237,234);
}
.block-color-blue_background {
	background: rgb(221,235,241);
}
.block-color-purple_background {
	background: rgb(234,228,242);
}
.block-color-pink_background {
	background: rgb(244,223,235);
}
.block-color-red_background {
	background: rgb(251,228,228);
}
.select-value-color-default { background-color: rgba(206,205,202,0.5); }
.select-value-color-gray { background-color: rgba(155,154,151, 0.4); }
.select-value-color-brown { background-color: rgba(140,46,0,0.2); }
.select-value-color-orange { background-color: rgba(245,93,0,0.2); }
.select-value-color-yellow { background-color: rgba(233,168,0,0.2); }
.select-value-color-green { background-color: rgba(0,135,107,0.2); }
.select-value-color-blue { background-color: rgba(0,120,223,0.2); }
.select-value-color-purple { background-color: rgba(103,36,222,0.2); }
.select-value-color-pink { background-color: rgba(221,0,129,0.2); }
.select-value-color-red { background-color: rgba(255,0,26,0.2); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="cddb85f6-42cf-4665-8b7f-8c8e69cfee79" class="page sans"><header><div class="page-header-icon undefined"><span class="icon">📙</span></div><h1 class="page-title">Non-lexical lifetimes: introduction</h1><table class="properties"><tbody><tr class="property-row property-row-created_time"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesCreatedAt"><path d="M6.98643729,14.0000972 C5.19579566,14.0000972 3.40419152,13.3106896 2.04245843,11.9323606 C-0.681017475,9.21200555 -0.680780251,4.76029539 2.04293482,2.04012507 C4.76664406,-0.68004331 9.22427509,-0.68004331 11.9480135,2.04013479 C13.272481,3.36277455 14,5.1330091 14,6.99552762 C14,8.87640182 13.2721894,10.6285043 11.9480135,11.9509302 C10.5679344,13.3105924 8.77756503,14.0000972 6.98643729,14.0000972 Z M10.2705296,7.00913883 L10.2705296,8.46099754 L10.2705296,8.65543362 L10.076181,8.65543362 L8.6543739,8.65543362 L5.72059514,8.65543362 L5.52619796,8.65543362 L5.52619796,8.46099754 L5.52619796,5.52541044 L5.52619796,3.37946773 L5.52619796,3.18502193 L5.72059514,3.18502193 L7.17253164,3.18502193 L7.36692883,3.18502193 L7.36692883,3.37946773 L7.36692883,6.81467358 L10.076181,6.81467358 L10.2705296,6.81467358 L10.2705296,7.00913883 Z M12.1601539,6.99552762 C12.1601539,5.61697497 11.6190112,4.32597154 10.6393933,3.34769528 C8.63253764,1.34336744 5.35197452,1.34061603 3.34153136,3.33944106 C3.33868273,3.34219247 3.33607716,3.34494388 3.33322852,3.34769528 C1.32397148,5.35459953 1.32372842,8.63641682 3.33322852,10.6433794 C5.34295224,12.6504489 8.62968901,12.6504489 10.6393933,10.6433794 C11.6190112,9.66506426 12.1601539,8.37408027 12.1601539,6.99552762 Z"></path></svg></span>Created</th><td><time>@August 24, 2021 4:00 PM</time></td></tr><tr class="property-row property-row-text"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesText"><path d="M7,4.56818 C7,4.29204 6.77614,4.06818 6.5,4.06818 L0.5,4.06818 C0.223858,4.06818 0,4.29204 0,4.56818 L0,5.61364 C0,5.88978 0.223858,6.11364 0.5,6.11364 L6.5,6.11364 C6.77614,6.11364 7,5.88978 7,5.61364 L7,4.56818 Z M0.5,1 C0.223858,1 0,1.223858 0,1.5 L0,2.54545 C0,2.8216 0.223858,3.04545 0.5,3.04545 L12.5,3.04545 C12.7761,3.04545 13,2.8216 13,2.54545 L13,1.5 C13,1.223858 12.7761,1 12.5,1 L0.5,1 Z M0,8.68182 C0,8.95796 0.223858,9.18182 0.5,9.18182 L11.5,9.18182 C11.7761,9.18182 12,8.95796 12,8.68182 L12,7.63636 C12,7.36022 11.7761,7.13636 11.5,7.13636 L0.5,7.13636 C0.223858,7.13636 0,7.36022 0,7.63636 L0,8.68182 Z M0,11.75 C0,12.0261 0.223858,12.25 0.5,12.25 L9.5,12.25 C9.77614,12.25 10,12.0261 10,11.75 L10,10.70455 C10,10.4284 9.77614,10.20455 9.5,10.20455 L0.5,10.20455 C0.223858,10.20455 0,10.4284 0,10.70455 L0,11.75 Z"></path></svg></span>Property</th><td></td></tr><tr class="property-row property-row-multi_select"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesMultipleSelect"><path d="M4,3 C4,2.447715 4.447715,2 5,2 L12,2 C12.5523,2 13,2.447716 13,3 C13,3.55228 12.5523,4 12,4 L5,4 C4.447715,4 4,3.55228 4,3 Z M4,7 C4,6.447715 4.447715,6 5,6 L12,6 C12.5523,6 13,6.447716 13,7 C13,7.55228 12.5523,8 12,8 L5,8 C4.447715,8 4,7.55228 4,7 Z M4,11 C4,10.447715 4.447715,10 5,10 L12,10 C12.5523,10 13,10.447716 13,11 C13,11.55228 12.5523,12 12,12 L5,12 C4.447715,12 4,11.55228 4,11 Z M2,4 C1.44771525,4 1,3.55228475 1,3 C1,2.44771525 1.44771525,2 2,2 C2.55228475,2 3,2.44771525 3,3 C3,3.55228475 2.55228475,4 2,4 Z M2,8 C1.44771525,8 1,7.55228475 1,7 C1,6.44771525 1.44771525,6 2,6 C2.55228475,6 3,6.44771525 3,7 C3,7.55228475 2.55228475,8 2,8 Z M2,12 C1.44771525,12 1,11.5522847 1,11 C1,10.4477153 1.44771525,10 2,10 C2.55228475,10 3,10.4477153 3,11 C3,11.5522847 2.55228475,12 2,12 Z"></path></svg></span>Tags</th><td><span class="selected-value select-value-color-green">Tech Design</span></td></tr><tr class="property-row property-row-url"><th><span class="icon property-icon"><svg viewBox="0 0 14 14" style="width:14px;height:14px;display:block;fill:rgba(55, 53, 47, 0.4);flex-shrink:0;-webkit-backface-visibility:hidden" class="typesUrl"><path d="M3.73333,3.86667 L7.46667,3.86667 C8.49613,3.86667 9.33333,4.70387 9.33333,5.73333 C9.33333,6.7628 8.49613,7.6 7.46667,7.6 L6.53333,7.6 C6.01813,7.6 5.6,8.0186 5.6,8.53333 C5.6,9.04807 6.01813,9.46667 6.53333,9.46667 L7.46667,9.46667 C9.5284,9.46667 11.2,7.79507 11.2,5.73333 C11.2,3.6716 9.5284,2 7.46667,2 L3.73333,2 C1.6716,2 0,3.6716 0,5.73333 C0,7.124 0.762067,8.33453 1.88953,8.97713 C1.87553,8.83107 1.86667,8.6836 1.86667,8.53333 C1.86667,7.92013 1.98753,7.33447 2.2036,6.7978 C1.99267,6.4954 1.86667,6.12953 1.86667,5.73333 C1.86667,4.70387 2.70387,3.86667 3.73333,3.86667 Z M12.1095,5.28907 C12.1231,5.4356 12.1333,5.58307 12.1333,5.73333 C12.1333,6.34607 12.0101,6.9294 11.7931,7.46513 C12.0059,7.768 12.1333,8.13573 12.1333,8.53333 C12.1333,9.5628 11.2961,10.4 10.2667,10.4 L6.53333,10.4 C5.50387,10.4 4.66667,9.5628 4.66667,8.53333 C4.66667,7.50387 5.50387,6.66667 6.53333,6.66667 L7.46667,6.66667 C7.98187,6.66667 8.4,6.24807 8.4,5.73333 C8.4,5.2186 7.98187,4.8 7.46667,4.8 L6.53333,4.8 C4.4716,4.8 2.8,6.4716 2.8,8.53333 C2.8,10.59507 4.4716,12.2667 6.53333,12.2667 L10.2667,12.2667 C12.3284,12.2667 14,10.59507 14,8.53333 C14,7.14267 13.2375,5.93167 12.1095,5.28907 Z"></path></svg></span>URL</th><td><a href="https://smallcultfollowing.com/babysteps/blog/2016/04/27/non-lexical-lifetimes-introduction/" class="url-value">https://smallcultfollowing.com/babysteps/blog/2016/04/27/non-lexical-lifetimes-introduction/</a></td></tr></tbody></table></header><div class="page-body"><p id="643468dd-0fd0-4255-bbcc-570ee62570d6" class="">Over the last few weeks, I’ve been devoting my free time to fleshing out the theory behind <strong>non-lexical lifetimes</strong> (NLL). I think I’ve arrived at a pretty good point and I plan to write various posts talking about it. Before getting into the details, though, I wanted to start out with a post that lays out roughly how today’s <em>lexical lifetimes</em> work and gives several examples of problem cases that we would like to solve.</p><p id="f40ece8e-49a1-450b-977d-3f3a22495b85" class="">The basic idea of the borrow checker is that values may not be mutated or moved while they are borrowed. But how do we know whether a value is borrowed? The idea is quite simple: whenever you create a borrow, the compiler assigns the resulting reference a <strong>lifetime</strong>. This lifetime corresponds to the span of the code where the reference may be used. The compiler will infer this lifetime to be the smallest lifetime that it can that still encompasses all the uses of the reference.</p><p id="e388c5aa-102d-418d-9707-0b23595ffebd" class="">Note that Rust uses the term lifetime in a very particular way. In everyday speech, the word lifetime can be used in two distinct – but similar – ways:</p><ol type="1" id="2778f514-2e78-466c-a909-547d2d1c8306" class="numbered-list" start="1"><li>The lifetime of a <strong>reference</strong>, corresponding to the span of time in which that reference is <strong>used</strong>.</li></ol><ol type="1" id="298506a4-ae1c-4583-a7e5-cca9c0298378" class="numbered-list" start="2"><li>The lifetime of a <strong>value</strong>, corresponding to the span of time before that value gets <strong>freed</strong> (or, put another way, before the destructor for the value runs).</li></ol><p id="d18dbb91-18ec-4023-a174-cebda57d3321" class="">This second span of time, which describes how long a value is valid, is of course very important. We refer to that span of time as the value’s <strong>scope</strong>. Naturally, lifetimes and scopes are linked to one another. Specifically, if you make a reference to a value, the lifetime of that reference cannot outlive the scope of that value, Otherwise your reference would be pointing into free memory.</p><p id="7933f8dd-59cf-467d-a5c6-654f6ac004ff" class="">To better see the distinction between lifetime and scope, let’s consider a simple example. In this example, the vector <code>data</code> is borrowed (mutably) and the resulting reference is passed to a function <code>capitalize</code>. Since <code>capitalize</code> does not return the reference back, the <em>lifetime</em> of this borrow will be confined to just that call. The <em>scope</em> of data, in contrast, is much larger, and corresponds to a suffix of the fn body, stretching from the <code>let</code> until the end of the enclosing scope.</p><pre id="912f6c1e-5584-47e8-95c0-686b9a73ecfe" class="code"><code>fn foo() {
    let mut data = vec![&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]; // --+ &#x27;scope
    capitalize(&amp;mut data[..]);          //   |
//  ^~~~~~~~~~~~~~~~~~~~~~~~~ &#x27;lifetime //   |
    data.push(&#x27;d&#x27;);                     //   |
    data.push(&#x27;e&#x27;);                     //   |
    data.push(&#x27;f&#x27;);                     //   |
} // &lt;---------------------------------------+

fn capitalize(data: &amp;mut [char]) {
    // do something
}
</code></pre><p id="16e363ce-c2e9-4a34-9b89-c9f97e2f35bf" class="">This example also demonstrates something else. Lifetimes in Rust today are quite a bit more flexible than scopes (if not as flexible as we might like, hence this RFC):</p><ul id="74d4838f-a2c7-43cb-9d0c-aa168cdbe715" class="bulleted-list"><li>A scope generally corresponds to some block (or, more specifically, a <em>suffix</em> of a block that stretches from the <code>let</code> until the end of the enclosing block) [<a href="https://smallcultfollowing.com/babysteps/blog/2016/04/27/non-lexical-lifetimes-introduction/">1</a>].</li></ul><ul id="5ee3f56a-2c2d-421d-90d2-4a74a773339b" class="bulleted-list"><li>A lifetime, in contrast, can also span an individual expression, as this example demonstrates. The lifetime of the borrow in the example is confined to just the call to <code>capitalize</code>, and doesn’t extend into the rest of the block. This is why the calls to <code>data.push</code> that come below are legal.</li></ul><p id="a796a487-ceed-45cf-a091-5161c2eb20ce" class="">So long as a reference is only used within one statement, today’s lifetimes are typically adequate. Problems arise however when you have a reference that spans multiple statements. In that case, the compiler requires the lifetime to be the innermost expression (which is often a block) that encloses both statements, and that is typically much bigger than is really necessary or desired. Let’s look at some example problem cases. Later on, we’ll see how non-lexical lifetimes fixes these cases.</p><h3 id="c8d9d7ce-2e72-4b3f-98fa-2f5db1a5d659" class="">Problem case #1: references assigned into a variable</h3><p id="882d5844-8824-47e7-9a4e-19266fd34940" class="">One common problem case is when a reference is assigned into a variable. Consider this trivial variation of the previous example, where the <code>&amp;mut data[..]</code> slice is not passed directly to <code>capitalize</code>, but is instead stored into a local variable:</p><pre id="761cea05-9f61-4bf6-9250-ab130476906a" class="code"><code>fn bar() {
    let mut data = vec![&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;];
    let slice = &amp;mut data[..]; // &lt;-+ &#x27;lifetime
    capitalize(slice);         //   |
    data.push(&#x27;d&#x27;); // ERROR!  //   |
    data.push(&#x27;e&#x27;); // ERROR!  //   |
    data.push(&#x27;f&#x27;); // ERROR!  //   |
} // &lt;------------------------------+
</code></pre><p id="b02f6ea5-e818-462d-90c9-3ad5f8314c3c" class="">The way that the compiler currently works, assigning a reference into a variable means that its lifetime must be as large as the entire scope of that variable. In this case, that means the lifetime is now extended all the way until the end of the block. This in turn means that the calls to <code>data.push</code> are now in error, because they occur during the lifetime of <code>slice</code>. It’s logical, but it’s annoying.</p><p id="69872922-f917-462d-9b35-a34a430920dc" class="">In this particular case, you could resolve the problem by putting <code>slice</code> into its own block:</p><pre id="76866fd8-a866-45a3-b7c8-0e2d242cbf1d" class="code"><code>fn bar() {
    let mut data = vec![&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;];
    {
        let slice = &amp;mut data[..]; // &lt;-+ &#x27;lifetime
        capitalize(slice);         //   |
    } // &lt;------------------------------+
    data.push(&#x27;d&#x27;); // OK
    data.push(&#x27;e&#x27;); // OK
    data.push(&#x27;f&#x27;); // OK
}
</code></pre><p id="1c6505ae-2e1b-4a91-a2c1-3539931c7342" class="">Since we introduced a new block, the scope of <code>slice</code> is now smaller, and hence the resulting lifetime is smaller. Of course, introducing a block like this is kind of artificial and also not an entirely obvious solution.</p><h3 id="eeb73d2f-bfb5-4731-9bfa-a22d7b5a4231" class="">Problem case #2: conditional control flow</h3><p id="817d8b4f-cd71-4edb-827e-bd1c060fc43d" class="">Another common problem case is when references are used in only match arm. This most commonly arises around maps. Consider this function, which, given some <code>key</code>, processes the value found in <code>map[key]</code> if it exists, or else inserts a default value:</p><pre id="1328d633-a252-4174-a868-780f48f83b54" class="code"><code>fn process_or_default&lt;K,V:Default&gt;(map: &amp;mut HashMap&lt;K,V&gt;,
                                   key: K) {
    match map.get_mut(&amp;key) { // -------------+ &#x27;lifetime
        Some(value) =&gt; process(value),     // |
        None =&gt; {                          // |
            map.insert(key, V::default()); // |
            //  ^~~~~~ ERROR.              // |
        }                                  // |
    } // &lt;------------------------------------+
}
</code></pre><p id="24cdf4b8-8045-466e-a608-9718fcdd5a70" class="">This code will not compile today. The reason is that the <code>map</code> is borrowed as part of the call to <code>get_mut</code>, and that borrow must encompass not only the call to <code>get_mut</code>, but also the <code>Some</code> branch of the match. The innermost expression that encloses both of these expressions is the match itself (as depicted above), and hence the borrow is considered to extend until the end of the match. Unfortunately, the match encloses not only the <code>Some</code> branch, but also the <code>None</code> branch, and hence when we go to insert into the map in the <code>None</code> branch, we get an error that the <code>map</code> is still borrowed.</p><p id="96e4249d-271a-4c8a-a5da-b19fab512966" class="">This <em>particular</em> example is relatively easy to workaround. One can (frequently) move the code for <code>None</code> out from the <code>match</code> like so:</p><pre id="612b6438-0f20-4cfc-b2cc-42896a281cb5" class="code"><code>fn process_or_default1&lt;K,V:Default&gt;(map: &amp;mut HashMap&lt;K,V&gt;,
                                    key: K) {
    match map.get_mut(&amp;key) { // -------------+ &#x27;lifetime
        Some(value) =&gt; {                   // |
            process(value);                // |
            return;                        // |
        }                                  // |
        None =&gt; {                          // |
        }                                  // |
    } // &lt;------------------------------------+
    map.insert(key, V::default());
}
</code></pre><p id="5833a39b-e3aa-4d28-9b04-72930ee92a42" class="">When the code is adjusted this way, the call to <code>map.insert</code> is not part of the match, and hence it is not part of the borrow. While this works, it is of course unfortunate to require these sorts of manipulations, just as it was when we introduced an artificial block in the previous example.</p><h3 id="5512cfd3-3c5b-4ac1-abd1-e8ebd6da9805" class="">Problem case #3: conditional control flow across functions</h3><p id="e898fd44-32ae-49c7-856e-e58e2cda5323" class="">While we were able to work around problem case #2 in a relatively simple, if irritating, fashion. there are other variations of conditional control flow that cannot be so easily resolved. This is particularly true when you are returning a reference out of a function. Consider the following function, which returns the value for a key if it exists, and inserts a new value otherwise (for the purposes of this section, assume that the <code>entry</code> API for maps does not exist):</p><pre id="1664fd00-cb6b-4a1e-a3f7-cab252e7a2c4" class="code"><code>fn get_default&lt;&#x27;m,K,V:Default&gt;(map: &amp;&#x27;m mut HashMap&lt;K,V&gt;,
                               key: K)
                               -&gt; &amp;&#x27;m mut V {
    match map.get_mut(&amp;key) { // -------------+ &#x27;m
        Some(value) =&gt; value,              // |
        None =&gt; {                          // |
            map.insert(key, V::default()); // |
            //  ^~~~~~ ERROR               // |
            map.get_mut(&amp;key).unwrap()     // |
        }                                  // |
    }                                      // |
}                                          // v
</code></pre><p id="fb8eb1cc-cdc0-4458-aa5c-193c340ecc21" class="">At first glance, this code appears quite similar the code we saw before. And indeed, just as before, it will not compile. But in fact the lifetimes at play are quite different. The reason is that, in the <code>Some</code> branch, the value is being <strong>returned out</strong> to the caller. Since <code>value</code> is a reference into the map, this implies that the <code>map</code> will remain borrowed <strong>until some point in the caller</strong> (the point <code>&#x27;m</code>, to be exact). To get a better intuition for what this lifetime parameter <code>&#x27;m</code> represents, consider some hypothetical caller of <code>get_default</code>: the lifetime <code>&#x27;m</code> then represents the span of code in which that caller will use the resulting reference:</p><pre id="ae918656-d9fb-4d9b-b6e1-461e3383b5e6" class="code"><code>fn caller() {
    let mut map = HashMap::new();
    ...
    {
        let v = get_default(&amp;mut map, key); // -+ &#x27;m
          // +-- get_default() -----------+ //  |
          // | match map.get_mut(&amp;key) {  | //  |
          // |   Some(value) =&gt; value,    | //  |
          // |   None =&gt; {                | //  |
          // |     ..                     | //  |
          // |   }                        | //  |
          // +----------------------------+ //  |
        process(v);                         //  |
    } // &lt;--------------------------------------+
    ...
}
</code></pre><p id="57a4233e-2fde-41c0-92e5-f69861101718" class="">If we attempt the same workaround for this case that we tried in the previous example, we will find that it does not work:</p><pre id="73760564-a600-4e02-9395-6776a5b30f1c" class="code"><code>fn get_default1&lt;&#x27;m,K,V:Default&gt;(map: &amp;&#x27;m mut HashMap&lt;K,V&gt;,
                                key: K)
                                -&gt; &amp;&#x27;m mut V {
    match map.get_mut(&amp;key) { // -------------+ &#x27;m
        Some(value) =&gt; return value,       // |
        None =&gt; { }                        // |
    }                                      // |
    map.insert(key, V::default());         // |
    //  ^~~~~~ ERROR (still)                  |
    map.get_mut(&amp;key).unwrap()             // |
}                                          // v
</code></pre><p id="4526f8f8-3153-4738-bf3e-d9529ae032cd" class="">Whereas before the lifetime of <code>value</code> was confined to the match, this new lifetime extends out into the caller, and therefore the borrow does not end just because we exited the match. Hence it is still in scope when we attempt to call <code>insert</code> after the match.</p><p id="64d0eb7c-9621-4cf6-850c-4c9b5f29af2f" class="">The workaround for this problem is a bit more involved. It relies on the fact that the borrow checker uses the precise control-flow of the function to determine what borrows are in scope.</p><pre id="db4083c5-2421-4882-b694-3ea48039cd19" class="code"><code>fn get_default2&lt;&#x27;m,K,V:Default&gt;(map: &amp;&#x27;m mut HashMap&lt;K,V&gt;,
                                key: K)
                                -&gt; &amp;&#x27;m mut V {
    if map.contains(&amp;key) {
    // ^~~~~~~~~~~~~~~~~~ &#x27;n
        return match map.get_mut(&amp;key) { // + &#x27;m
            Some(value) =&gt; value,        // |
            None =&gt; unreachable!()       // |
        };                               // v
    }

    // At this point, `map.get_mut` was never
    // called! (As opposed to having been called,
    // but its result no longer being in use.)
    map.insert(key, V::default()); // OK now.
    map.get_mut(&amp;key).unwrap()
}
</code></pre><p id="7dbe1a4b-b074-4d98-b484-410f9f9486ed" class="">What has changed here is that we moved the call to <code>map.get_mut</code> inside of an <code>if</code>, and we have set things up so that the if body unconditionally returns. What this means is that a borrow begins at the point of <code>get_mut</code>, and that borrow lasts until the point <code>&#x27;m</code> in the caller, but the borrow checker can see that this borrow <em>will not have even started</em> outside of the <code>if</code>. So it does not consider the borrow in scope at the point where we call <code>map.insert</code>.</p><p id="1dc3f533-a89c-4d8b-98e3-ff32cac822d8" class="">This workaround is more troublesome than the others, because the resulting code is actually less efficient at runtime, since it must do multiple lookups.</p><p id="c0c519c5-1351-4948-8ef8-02bc812e1400" class="">It’s worth noting that Rust’s hashmaps include an <code>entry</code> API that one could use to implement this function today. The resulting code is both nicer to read and more efficient even than the original version, since it avoids extra lookups on the “not present” path as well:</p><pre id="f8f3a6ba-9698-444e-aef7-ad14d5b2e09c" class="code"><code>fn get_default3&lt;&#x27;m,K,V:Default&gt;(map: &amp;&#x27;m mut HashMap&lt;K,V&gt;,
                                key: K)
                                -&gt; &amp;&#x27;m mut V {
    map.entry(key)
       .or_insert_with(|| V::default())
}
</code></pre><p id="177b2ca0-dae1-40e9-b568-e9c657f4e58e" class="">Regardless, the problem exists for other data structures besides <code>HashMap</code>, so it would be nice if the original code passed the borrow checker, even if in practice using the <code>entry</code> API would be preferable. (Interestingly, the limitation of the borrow checker here was one of the motivations for developing the <code>entry</code> API in the first place!)</p><p id="a0c01b69-8601-46e1-befc-464019cd030b" class="">This post looked at various examples of Rust code that do not compile today, and showed how they can be fixed using today’s system. While it’s good that workarounds exist, it’d be better if the code just compiled as is. In an upcoming post, I will outline my plan for how to modify the compiler to achieve just that.</p><h2 id="e7409d46-1ab1-4360-b162-084c19582ed3" class="">Endnotes</h2><p id="acd9c3ea-474f-419e-b16c-55fd469a4fdd" class=""><strong>1.</strong> Scopes always correspond to blocks with one exception: the scope of a temporary value is sometimes the enclosing statement.</p></div></article></body></html>